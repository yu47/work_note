## ubuntu

### 搭建本地ubuntu镜像源

* * sudo apt install apt-mirror

  * sudo vi /etc/apt/mirror.list

    ```
    ########### 默认为：/vnrig ##################
    #下载位置 默认为：/var/spool/apt-mirror/
    #set mirror_path  $bms/XXXXX/XXX
    #
    #set mirror_path  $base_path/mirror
    #set skel_path    $base_path/skel
    #set var_path     $base_path/var
    #set cleanscript $var_path/clean.sh
    #set defaultarch  <running host architecture>
    #set postmirror_script $var_path/postmirror.sh
    #set run_postmirror 0
    set nthreads     20
    set _tilde 0
    #
    ############# end config ##############
    deb [arch=amd64] http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
    deb [arch=amd64] http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
    deb [arch=amd64] http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
    deb [arch=amd64] http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse
    deb [arch=amd64] http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
    
    # 下载完成后清除部分空间
    clean https://mirrors.aliyun.com/ubuntu
    
    ```

  * ubuntu 2204 代号:jammy 大小：335.7GB

  * ubuntu 2004 代号:focal  大小：440.8GB

  * ubuntu 1804 代号:bionic 大小：296.2GB

  * ubuntu 1604 代号:xenial 大小：115.5GB

  

#### apt-mirror 2017停止更新

####	需要手动下载icons

  ```
cd /data/ubuntu/mirror/mirrors.aliyun.com/ubuntu/dists/
  dists="*"
for dist in ${dists}; do
    for comp in main  multiverse universe; do
    for size in 48 64 128; do
      wget http://archive.ubuntu.com/ubuntu/dists/${dist}/${comp}/dep11/icons-${size}x${size}@2.tar.gz -O ${dist}/${comp}/dep11/icons-${size}x${size}@2.tar.gz;
     done
   done
  done
  
  ```

  

  #### 搭建访问

  * sudo apt install apache2
  * ln –s /home/xxx/xxx/mirror/mirrors.aliyun.com/Ubuntu /var/www/html/Ubuntu

  #### 需要访问的用户

  * 修改镜像源

    ```
    deb http://127.0.0.1/ubuntu/ bionic main restricted universe multiverse
    deb http://127.0.0.1/ubuntu/ bionic-updates main restricted universe multiverse
    deb http://127.0.0.1/ubuntu/ bionic-security main restricted universe multiverse
    deb http://127.0.0.1/ubuntu/ bionic-backports main restricted universe multiverse
    deb http://127.0.0.1/ubuntu/ bionic-proposed main restricted univers pip2pi ./pypi_packages -r request.txt
    ```

## python

		1. dir2pip2pi ./pypi_packages -r request.txt
		2. dir2pi ./pypi_packages   /生成simple

#### 搭建web

```
python -m http.server 8080 --bind your_machine_ip --directory /path/to/pypi_packages/simple
```

#### 添加对搜索IP的信任，否则会install失败
```
pip config set install.trusted-host 168.163.1.1
```





## docker

#### 安装方式1：skopeo 

```
SKOPEO_VERSION=v1.3.0
git clone --branch ${SKOPEO_VERSION} https://github.com/containers/skopeo
cd skopeo

BUILD_IMAGE=nixos/nix:2.3.12
docker run --rm -t -v $PWD:/build ${BUILD_IMAGE} \
sh -c "cd /build && nix build -f nix && cp ./result/bin/skopeo skopeo"
```

#### 安装方式2：skopeo 

```
git clone https://github.com/containers/skopeo.git
cd skopeo

安装 go 最新版
make bin/skopeo
se

```
1. pip install docker-compose

```

pip install docker-compose

```

```

##### harbor安装包

下载 https://github.com/goharbor/harbor/releases
arbor
# cp harbor.yml.tmpl  harbor.yml.tgz 
cd harbor
# cp harbor.yml.tmpl  harbor.yml
# mkdir -p /opt/application/harbor     //用于存放harbor的持久化数

修改harbor.yml
harbor.yml配置文件主要修改参数如下：
hostname: 192.168.0.8:9999          //设置访问地址，可以使用ip、域名，不可以设置为127.0.0.1或localault is 80. If https enabled, this port will redirect is 80. If https enabled, this port will redirect to https port
portnabled, this port will redirect to https port
port: 9999              l redirect to https port
port: 9999   ttps r  at          

#https配置（如不需要可不配置,注释掉）
# https related config
#https:
# https port for harbor, default is 443
 #port: 443
# The path of cert and key files for nginx
 #certificate: /your/certificate/path
 #private_key: /your/private/key/path
```

2. install

```
./install.sh
```

3. 启动harbor

```
docker-compose up
```



#### 搬运互联网上的镜像 到 本地仓库

```
sudo ./skopeo  copy  docker://{DOCKER_NAME}:latest --dest-creds=admin:Harbor12345 docker://127.0.0.1:8808/library/{DOCKER_NAME}:latest --insecure-policy --src-tls-verify=false --dest-tls-verify=false -a

--dest-creds=admin:Harbor12345   //推送的账号密码
127.0.0.1:8808/library/     //推送的路径
 --insecure-policy --src-tls-verify=false --dest-tls-verify=false  //不使用代理
 -a 			//如果有多个架构，全部copy
```



```
./skopeo inspect --tls-verify=false  docker://127.0.0.1:8808/library/adminer:latest --raw | jq '.'
```



#### copy脚本1

```shell
#!/bin/bash

test

```